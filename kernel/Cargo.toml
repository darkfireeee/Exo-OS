[package]
name = "exo-kernel"
version = "0.5.0"
authors = ["ExoOS Team"]
edition = "2021"
description = "Exo-OS noyau expérimental (x86_64 bare-metal, multiboot2)"
license = "MIT OR Apache-2.0"

[lib]
name = "exo_kernel"
path = "src/lib.rs"
crate-type = ["staticlib", "rlib"]

[dependencies]
# Dépendances fondamentales no_std
bitflags = "2.4.1"
spin = "0.9.8"
volatile = "0.5.1"
lazy_static = { version = "1.4.0", features = ["spin_no_std"] }

# Allocation mémoire
linked_list_allocator = "0.10.5"

# Multiboot2 pour le parsing des informations de boot
multiboot2 = "0.22"

# IPC lock-free
crossbeam-queue = { version = "0.3.11", default-features = false, features = ["alloc"] }

log = "0.4"

# Structures de données no_std
hashbrown = { version = "0.14.2", default-features = false, features = ["inline-more", "ahash"] }
bit_field = "0.10.2"
hex = { version = "0.4", default-features = false, features = ["alloc"] }
virtio-drivers = "0.7.0"

# Bibliothèques Exo-OS
exo_types = { path = "../libs/exo_types" }
exo_ipc = { path = "../libs/exo_ipc" }
exo_crypto = { path = "../libs/exo_crypto" }

# Cryptographie pour l'audit sécurisé (optionnel)
sha3 = { version = "0.10.8", default-features = false, optional = true }
ed25519-dalek = { version = "2.1.1", default-features = false, features = ["fast"], optional = true }

# Sérialisation pour l'IPC (optionnel)
capnp = { version = "0.18.1", default-features = false, optional = true }

# Boot loader for creating bootable disk images
bootloader = "0.9.23"

# Dépendances spécifiques à l'architecture
[target.'cfg(target_arch = "x86_64")'.dependencies]
x86_64 = "0.14.11"
raw-cpuid = "10.7.0"
uart_16550 = "0.2.19"
pic8259 = "0.10.4"

[target.'cfg(target_arch = "aarch64")'.dependencies]
aarch64-cpu = "9.4.0"

[features]
default = []
binary = []
crypto = ["sha3", "ed25519-dalek"]
post-quantum = []
serialization = ["capnp"]
# Optimisations Zero-Copy Fusion
fusion_rings = []
windowed_context_switch = []
hybrid_allocator = []
predictive_scheduler = []
adaptive_drivers = []
# Sortie automatique QEMU après microbenchmarks (isa-debug-exit)
bench_auto_exit = []

[build-dependencies]
cc = "1.0"

[package.metadata.exo-os]
min-supported-rust = "nightly"
boot-protocol = "multiboot2"
arch = "x86_64"
panic-strategy = "abort"
features-default = []
features-optional = ["fusion_rings", "hybrid_allocator", "windowed_context_switch", "predictive_scheduler", "adaptive_drivers", "bench_auto_exit", "crypto", "serialization"]
